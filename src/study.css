/* GBC Anki Template - Final Fluid Version */

/* --- Part 1: Global Design Tokens (The Foundation) --- */
:root {
    /* --- Colors --- */
    --c-text: #E0E0E0;
    --c-text-subtle: #9E9E9E;
    --c-bg: #212121;
    --c-bg-alt: #303030;
    --c-border: #424242;
    --c-accent: #82AAFF;
    --c-cloze: #FFCB6B;
    --c-pitch-line: #F07178;

    /* --- Fonts --- */
    --font-main: system-ui, 'Hiragino Sans', 'Yu Gothic Medium', 'Microsoft YaHei', 'PingFang SC', sans-serif;
    --font-reading: 'Meiryo', 'Hiragino Sans', 'Microsoft YaHei', sans-serif;

    /* --- Fluid Size System (The Core Logic) --- */
    --fluid-unit: clamp(0.8rem, 2vw + 0.1rem, 1.2rem); /* Base unit scales with viewport width */

    /* Font Sizes (derived from the base unit) */
    --font-size-xs:   calc(var(--fluid-unit) * 0.9);   /* Tags */
    --font-size-s:    calc(var(--fluid-unit) * 1);     /* Body, Meaning */
    --font-size-m:    calc(var(--fluid-unit) * 1.6);   /* Sentence */
    --font-size-l:    calc(var(--fluid-unit) * 1.8);   /* Pitch Accent Kana */
    /* [修改] 从 3.5 降级为 2.5，手机上看起来会舒服很多 */
    --font-size-xl:   calc(var(--fluid-unit) * 2.5);   /* Main Expression */

    /* Spacing (derived from the base unit) */
    --spacing-xs: calc(var(--fluid-unit) * 0.25);
    --spacing-s:  calc(var(--fluid-unit) * 0.5);
    --spacing-m:  calc(var(--fluid-unit) * 1);
    --spacing-l:  calc(var(--fluid-unit) * 1.5);
    --spacing-xl: calc(var(--fluid-unit) * 2);

    /* --- Other --- */
    --border-radius: var(--spacing-s);
}

/* --- Part 2: Global Styles & Layouts (Applying Tokens) --- */
.nightMode {}
html, body { background-color: var(--c-bg); }

#card {
    display: flex;
    flex-direction: column;
    justify-content: center; /* Change 'center' to 'flex-start' */
    gap: var(--spacing-l);
    padding: var(--spacing-m); /* Slightly increase padding for better breathing room */
    font-family: var(--font-main);
    color: var(--c-text);
    background-color: var(--c-bg);
    min-height: 95vh;
}

.card__section {
    background-color: var(--c-bg-alt);
    border-radius: var(--border-radius);
    padding: var(--spacing-l);
    border: 1px solid var(--c-border);
}

.section-divider {
    border: none;
    border-top: 1px solid var(--c-border);
    margin: 0;
}

/* --- Video, Sentence, Audio --- */
.video-player {
    width: 100%;
    max-inline-size: 600px; /* 限制最大宽度 */
    display: block;
    margin: 0 auto; /* 居中 */
    border-radius: var(--border-radius);
}

.video-container {
    text-align: center; /* 确保视频在容器内居中 */
    padding: var(--spacing-s); /* 视频容器稍微紧凑一点 */
}

/* --- Sentence Area --- */
.sentence-container {
    text-align: center;
}

.sentence {
    font-size: var(--font-size-m);
    line-height: 2.2;
}

.sentence-meaning {
    margin-top: var(--spacing-m);
    font-size: var(--font-size-s);
    color: var(--c-text-subtle);
    border-top: 1px dashed var(--c-border);
    padding-top: var(--spacing-m);
}


/* --- 挖空核心样式 (Cloze Logic) --- */

.cloze-placeholder {
    /* 1. 隐藏原始文字 */
    font-size: 0;
    /* 2. 定义挖空框的外观 */
    display: inline-block;
    min-width: 60px; /* 最小宽度，防止太短不好点 */
    padding: 0 5px;
    border-bottom: 0px solid var(--c-cloze); /* 下划线风格 */
    cursor: pointer; /* 鼠标变手型，提示可点击 */
    vertical-align: middle;
    /* 保持原有颜色变量 */
    color: var(--c-cloze);
}

/* 3. 使用伪元素插入占位符 [...] */
.cloze-placeholder::before {
    content: "[ ... ]";
    font-size: var(--font-size-m); /* 恢复字体大小 */
    font-weight: bold;
}

/* --- 交互：鼠标悬停或点击时揭示答案 --- */
.cloze-placeholder:hover,
.cloze-placeholder:active {
    /* 恢复显示文字 */
    font-size: var(--font-size-m);
    /* 去掉占位符外观 */
    border-bottom: none;
    background-color: color-mix(in srgb, var(--c-cloze) 20%, transparent); /* 给个背景色高亮 */
    border-radius: 4px;
}

/* 鼠标悬停时，去掉 [...] */
.cloze-placeholder:hover::before,
.cloze-placeholder:active::before {
    content: "";
}

ruby {
    margin: 0 0.1em;
}

/* --- Expression Details (Old Styles, will be refactored in Step 3) --- */
.expression-title-group { display: flex; align-items: center; gap: var(--spacing-m); }
.expression-main { font-size: var(--font-size-xl); font-weight: bold; margin: 0; }
.audio-button { background: none; border: none; padding: var(--spacing-s); cursor: pointer; border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; transition: background-color 0.2s ease; }
.audio-button svg { fill: var(--c-text-subtle); transition: fill 0.2s ease; width: var(--font-size-l); height: var(--font-size-l); }
.audio-button:hover { background-color: var(--c-border); }
.audio-button:hover svg { fill: var(--c-text); }


/* --- Part 3: 顶部布局优化 (Subordinate Pitch Style) --- */

/* 1. 顶部大容器：垂直排列，居中 */
.expression-header-ladder {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 8px; /* 控制 单词-声调-标签 之间的间距 */

    border-bottom: 1px solid var(--c-border);
    padding-bottom: var(--spacing-m);
    margin-bottom: var(--spacing-l);
}

/* 2. [核心修复] 单词行：使用 Grid 完美居中 */
/* 这里的魔法是：左边空一格，中间放字，右边放喇叭。字永远在正中间。 */
.ladder-item__expression {
    display: grid;
    grid-template-columns: 1fr auto 1fr; /* 左(1fr) 中(auto) 右(1fr) */
    align-items: center;
    width: 100%;
    margin-bottom: -5px; /* 稍微抵消一点行高带来的空隙 */
}

.expression-main {
    grid-column: 2; /* 强制锁定在第2列（正中间） */
    font-size: var(--font-size-xl);
    font-weight: bold;
    margin: 0;
    line-height: 1.0;
    text-align: center;
    white-space: nowrap;
}

.ladder-item__expression .audio-button {
    grid-column: 3; /* 放在第3列（右边） */
    justify-self: start; /* 靠左对齐，紧贴单词区域的边缘 */
    margin-left: 10px;   /* 离单词稍微远一点点，看着不累 */
    transform: scale(0.9);
}

/* 3. 声调行 */
.ladder-item__pitch {
    transform: scale(0.6); /* 适当缩小 */
    transform-origin: center top;
    margin: 0;
    opacity: 0.8;
}

/* 修复 SVG 显示 */
#pitch-accent-svg-container svg { display: block; overflow: visible; }

/* --- [新增] 标签组内部布局 --- */
/* 4. 标签行 (现在位于顶部区域) */
.meta-top-right {
    display: flex;
    flex-wrap: wrap;
    justify-content: center; /* 标签居中排列 */
    align-items: center;
    gap: 6px;

    margin-top: 5px; /* 离上面的声调图远一点 */
    width: 100%;
}

/* [核心修复] 给标签包裹层也加上布局 */
.tags-group {
    display: inline-flex; /* 让它根据内容变宽 */
    flex-wrap: wrap;      /* 允许换行 */
    gap: 6px;             /* 控制标签与标签之间的距离 */
    align-items: center;
    justify-content: center;
}

/* 标签样式 (保持小巧风格) */
.tag-anki {
    font-size: 0.7rem;
    color: var(--c-text-subtle);
    background-color: transparent; /* 不需要额外背景 */
    border: 1px solid var(--c-border);
    padding: 2px 8px;
    border-radius: 4px;
    line-height: 1.2;
}

.freq-badge {
    font-size: 0.7rem;
    font-family: monospace;
    color: #FFCB6B;
    background-color: rgba(255, 203, 107, 0.1); /* 淡淡的金色背景 */
    border: 1px solid rgba(255, 203, 107, 0.3);
    padding: 2px 8px;
    border-radius: 4px;
    line-height: 1.2;
}


/* --- Unified Audio Button Styles --- */

/* We can reuse the .audio-button class for the sentence audio button.
    Its styles for hover effects, etc., are already defined globally.
   We might want to make it slightly larger for sentences. */
.sentence-audio-wrapper .audio-button {
    /* Optional: make the sentence audio button a bit bigger */
    transform: scale(1.2);
}

/* --- Inline Sentence Audio Button Layout --- */

.sentence-with-audio {
    /* This is the new Flexbox parent */
    display: flex;
    align-items: center; /* KEY: Vertically align button and text */
    justify-content: center; /* Center the whole group */
    gap: var(--spacing-m); /* Space between button and sentence */
    flex-direction: row-reverse; /* The magic happens here */
}

.sentence {
    /* The sentence text itself */
    text-align: left; /* Align text to the left within its own box */
}

.sentence-audio-button {
    /* Make the button shrink-proof so it doesn't get squashed */
    flex-shrink: 0;
}


/* --- 1. Proverb/Motto Styling (All effects combined) --- */
.listening-front .listening-prompt-container {
    position: relative; /* Needed for the decorative lines */
    padding-top: var(--spacing-m);
    padding-bottom: var(--spacing-m);
}

.listening-front .listening-prompt {
    /* Scheme 1: Typography */
    font-family: 'Yu Mincho', 'Hiragino Mincho ProN', serif;

    /* Scheme 3: Layout & Spacing */
    letter-spacing: 0.1em; /* Increased letter spacing */
    line-height: 1.8;

    /* Scheme 2B: Gradient Text */
    background: linear-gradient(180deg, var(--c-text-subtle), #424242);
    -webkit-background-clip: text;
    background-clip: text;
    color: transparent; /* Fallback for gradient */
    -webkit-text-fill-color: transparent;
    font-style: normal; /* Override the old italic style */
}

/* Scheme 2A: Decorative Lines */
.listening-front .listening-prompt::before,
.listening-front .listening-prompt::after {
    content: '';
    position: absolute;
    left: 50%;
    transform: translateX(-50%);
    width: 30%; /* Width of the lines */
    height: 1px;
    background-color: var(--c-border);
}
.listening-front .listening-prompt::before {
    top: 0; /* Position the top line */
}
.listening-front .listening-prompt::after {
    bottom: 0; /* Position the bottom line */
}


/* --- 2. Hint Visibility Toggle Styling --- */
#hint-trigger-container {
    cursor: pointer; /* Change cursor to a pointer to indicate it's clickable */
}

.sentence-text-hint {
    transition: color 0.3s ease; /* Smooth transition for visibility */
}

/* The state when the hint is visible */
#hint-trigger-container.is-visible .sentence-text-hint {
    color: var(--c-text-subtle); /* Make the text visible */
}

/* --- 1. 全局粗体重置 (让【用法】回归正常) --- */
b, strong {
    color: inherit; /* 跟随周围文字颜色 */
    font-weight: bold;
    text-decoration: none;
}

/* --- 2. 仅针对句子的语法高亮 (Targeted Highlighting) --- */
.sentence b, .sentence strong {
    color: #7fb9b9; /* 橙色 */
    font-weight: 900;
    text-decoration: underline;
    text-decoration-color: rgba(202, 224, 221, 0.3);
    padding: 0 2px; /* 稍微加点间距，更透气 */
}


/* Note 样式 */
.sentence-note {
    margin-top: var(--spacing-s);
    font-size: var(--font-size-s);
    color: var(--c-accent);
    background-color: rgba(130, 170, 255, 0.1); /* 淡淡的蓝色背景 */
    padding: 5px 10px;
    border-radius: 4px;
    border-left: 3px solid var(--c-accent);
    text-align: left; /* Note 通常较长，左对齐更好读 */
}


/* --- 释义容器美化 --- */
/* 释义外框 */
.meaning-wrapper {
    /* 使用 Flex 布局来控制内部顺序 */
    display: flex;
    flex-direction: column;
    background-color: rgba(255, 255, 255, 0.03);
    border-radius: var(--border-radius);
    padding: var(--spacing-m); /* 统一内边距 */
    margin-top: var(--spacing-s);
    border-left: 4px solid var(--c-border);
}

/* 调整释义内容的间距 */
.meaning-content {
    font-size: var(--font-size-s);
    line-height: 1.6;
}